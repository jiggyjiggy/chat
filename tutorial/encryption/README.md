# wireshark를 이용한 패킷캡쳐 분석

## 평문 통신

<img width="1624" alt="평문통신-wireshark 패킷캡쳐" src="https://github.com/user-attachments/assets/1ba63175-63e7-4ab7-94e8-e07dbcfeb657">

1번 패킷:
- 내용: 63304 → 12321 [SYN]
- 분석: 클라이언트가 서버에 연결 요청을 보낸 것입니다. SYN 플래그가 설정되어 있어, 이는 TCP 연결을 설정하기 위한 첫 번째 단계인 3-way handshake의 시작입니다. 이 패킷은 클라이언트의 초기 시퀀스 번호를 포함하고 있습니다.

2번 패킷:
- 내용: 12321 → 63304 [SYN, ACK]
- 분석: 서버가 클라이언트의 연결 요청을 수락한 것입니다. SYN과 ACK 플래그가 모두 설정되어 있어, 서버가 클라이언트의 SYN 패킷을 확인했음을 나타내며, 동시에 자신의 연결 요청을 위해 SYN 패킷도 전송하고 있습니다. 이 패킷은 서버의 초기 시퀀스 번호를 포함합니다.

3번 패킷:
- 내용: 63304 → 12321 [ACK]
- 분석: 클라이언트가 서버의 SYN, ACK 패킷을 수신하고, 이를 확인하기 위해 ACK 패킷을 전송합니다. 이는 클라이언트가 서버와의 연결이 성공적으로 설정되었음을 나타냅니다. 이제 TCP 연결이 완료되었습니다.

4번 패킷:
- 내용: 63304 → 12321 [PSH, ACK]
- 분석: 클라이언트가 서버에 데이터를 보내는 패킷입니다. PSH 플래그가 설정되어 있어, 서버에게 이 데이터가 즉시 처리되도록 요청합니다. ACK 플래그도 설정되어 있어, 이 패킷은 서버의 이전 패킷에 대한 확인 응답을 포함하고 있습니다. 이 패킷의 내용은 "HELLO"입니다.

5번 패킷:
- 내용: [TCP Window Update] 12321 → 63304 [ACK]
- 분석: 서버가 클라이언트에게 수신 버퍼 상태를 업데이트하는 패킷입니다. 이 패킷은 실제 데이터 전송과는 관련이 없지만, TCP의 흐름 제어를 위한 ACK 패킷입니다. 서버가 클라이언트의 데이터 수신을 확인하고, 수신 가능한 버퍼 크기를 업데이트합니다.

6번 패킷:
- 내용: 12321 → 63304 [ACK]
- 분석: 서버가 클라이언트로부터 수신한 데이터에 대한 확인 응답입니다. 이 패킷은 클라이언트가 보낸 "HELLO" 메시지를 성공적으로 수신했음을 나타냅니다.

7번 패킷:
- 내용: 12321 → 63304 [PSH, ACK]
- 분석: 서버가 클라이언트에게 데이터를 전송하는 패킷입니다. 이 패킷은 데이터 전송과 함께 ACK도 포함되어 있으며, PSH 플래그가 설정되어 있어 클라이언트에게 이 데이터가 즉시 처리되도록 요청합니다.

8번 패킷:
- 내용: 12321 → 63304 [FIN, ACK]
- 분석: 서버가 더 이상 데이터를 보내지 않겠다는 의사를 나타내기 위해 FIN 패킷을 전송합니다. 이 패킷은 연결 종료 요청을 의미하며, 동시에 클라이언트가 보낸 데이터에 대한 확인 응답(ACK)도 포함되어 있습니다.

9번 패킷:
- 내용: 63304 → 12321 [ACK]
- 분석: 클라이언트가 서버의 FIN 패킷을 수신하고, 이를 확인하기 위해 ACK 패킷을 보냅니다. 이는 클라이언트가 서버의 종료 요청을 수락했음을 나타냅니다.

10번 패킷:
- 내용: 63304 → 12321 [FIN, ACK]
- 분석: 클라이언트가 이제 더 이상 데이터를 보내지 않겠다는 의사를 나타내기 위해 자신의 FIN 패킷을 서버에 전송합니다. 이 패킷은 클라이언트가 연결 종료를 요청하는 단계입니다. 동시에 이전에 서버가 보낸 데이터에 대한 확인 응답(ACK)도 포함되어 있습니다.

11번 패킷:
- 내용: 12321 → 63304 [ACK]
- 분석: 서버가 클라이언트의 FIN 패킷을 수신하고, 이를 확인하는 ACK 패킷을 보냅니다. 이는 클라이언트의 연결 종료 요청을 수락했음을 나타내며, 이제 연결이 종료됩니다.

12번 패킷:
- 내용: 12321 → 63304 [ACK]
- 분석: 이 패킷은 서버가 클라이언트의 마지막 ACK 패킷을 확인하는 메시지입니다. 실제로 이 패킷은 연결 종료를 위한 최종 확인으로, 모든 연결 종료 절차가 완료되었음을 나타냅니다.

요약<br>
이 모든 패킷들은 TCP의 연결 설정, 데이터 전송, 연결 종료의 과정에서 발생합니다. 각 단계는 서로의 상태를 확인하고, 데이터의 신뢰성을 보장하기 위한 것입니다. 3-way handshake를 통해 연결이 설정되고, 데이터 전송 후 4-way handshake를 통해 연결이 종료되는 과정을 포함하고 있습니다.

---

## 암호화 통신

<img width="1624" alt="암호화통신-wireshark 패킷캡쳐" src="https://github.com/user-attachments/assets/f5a2b554-8286-4289-9455-52a1e8cd688e">

3번 패킷:
- 내용: 63775 → 12345 [SYN]
- 분석: 클라이언트(포트 63775)가 서버(포트 12345)에 연결 요청을 보내는 패킷입니다. SYN 플래그가 설정되어 있어 TCP 연결을 시작하는 첫 번째 단계인 3-way handshake의 시작을 나타냅니다. 이 패킷은 클라이언트의 초기 시퀀스 번호를 포함하고 있습니다.

4번 패킷:
- 내용: 12345 → 63775 [SYN, ACK]
- 분석: 서버가 클라이언트의 연결 요청을 수락한 것입니다. SYN과 ACK 플래그가 모두 설정되어 있어, 서버가 클라이언트의 SYN 패킷을 확인하고, 자신의 SYN 패킷을 포함한 응답입니다. 이 패킷은 서버의 초기 시퀀스 번호를 포함하고 있습니다.

5번 패킷:
- 내용: 63775 → 12345 [ACK]
- 분석: 클라이언트가 서버의 SYN, ACK 패킷을 수신하고, 이를 확인하기 위해 ACK 패킷을 전송합니다. 이는 클라이언트가 서버와의 연결이 성공적으로 설정되었음을 나타냅니다. 이제 TCP 연결이 완료되었습니다.

6번 패킷:
- 내용: [TCP Window Update] 12345 → 63775 [ACK]
- 분석: 서버가 클라이언트에게 수신 버퍼 상태를 업데이트하는 패킷입니다. 이 패킷은 실제 데이터 전송과는 관련이 없지만, TCP의 흐름 제어를 위한 ACK 패킷입니다. 서버가 클라이언트의 데이터 수신을 확인하고, 수신 가능한 버퍼 크기를 업데이트합니다.

7번 패킷:
- 내용: 63775 → 12345 [PSH, ACK]
- 분석: 클라이언트가 서버에 암호화된 데이터를 전송하는 패킷입니다. PSH 플래그가 설정되어 있어, 서버에게 이 데이터가 즉시 처리되도록 요청합니다. 이 패킷의 길이는 256바이트이며, 데이터의 내용은 암호화된 메시지입니다. ACK 플래그도 설정되어 있어, 서버의 이전 패킷에 대한 확인 응답을 포함하고 있습니다.

8번 패킷:
- 내용: 63775 → 12345 [FIN, PSH, ACK]
- 분석: 클라이언트가 더 이상의 데이터를 보내지 않겠다는 의사를 나타내기 위해 FIN 패킷을 전송합니다. 이 패킷은 암호화된 데이터의 마지막 조각을 포함하고 있으며, 동시에 이전 서버의 패킷에 대한 확인 응답(ACK)도 포함되어 있습니다.

9번 패킷:
- 내용: 12345 → 63775 [ACK]
- 분석: 서버가 클라이언트의 FIN 패킷을 수신하고, 이를 확인하기 위해 ACK 패킷을 보냅니다. 이는 클라이언트가 서버의 종료 요청을 수락했음을 나타냅니다.

10번 패킷:
- 내용: 12345 → 63775 [ACK]
- 분석: 이 패킷은 서버가 클라이언트에게 보내는 ACK 패킷입니다. 클라이언트의 이전 패킷에 대한 확인 응답으로, 서버가 클라이언트의 마지막 데이터 수신을 확인합니다.

11번 패킷:
- 내용: 12345 → 63775 [FIN, ACK]
- 분석: 서버가 더 이상 데이터를 보내지 않겠다는 의사를 나타내기 위해 FIN 패킷을 전송합니다. 이 패킷은 서버가 종료 요청을 의미하며, 동시에 클라이언트가 보낸 데이터에 대한 확인 응답(ACK)도 포함되어 있습니다.

12번 패킷:
- 내용: 63775 → 12345 [ACK]
- 분석: 클라이언트가 서버의 FIN 패킷을 수신하고, 이를 확인하기 위해 ACK 패킷을 보냅니다. 이는 클라이언트가 서버의 종료 요청을 수락했음을 나타내며, 이제 연결이 종료됩니다.

요약<br>
이 모든 패킷들은 TCP의 연결 설정, 데이터 전송, 연결 종료의 과정에서 발생합니다. 각 단계는 서로의 상태를 확인하고, 데이터의 신뢰성을 보장하기 위한 것입니다. 3-way handshake를 통해 연결이 설정되고, 데이터 전송 후 4-way handshake를 통해 연결이 종료되는 과정을 포함하고 있습니다. 암호화된 통신에서는 데이터가 실제로 암호화되어 전송되기 때문에 패킷 내용은 확인할 수 없지만, 패킷의 길이와 플래그를 통해 어떤 데이터가 전송되었는지 유추할 수 있습니다.


---

# 도움이 되는 자료
## 3-Way Handshake & 4-Way Handshake
https://velog.io/@averycode/%EB%84%A4%ED%8A%B8%EC%9B%8C%ED%81%AC-TCPUDP%EC%99%80-3-Way-Handshake4-Way-Handshake
